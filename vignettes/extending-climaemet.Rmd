---
title: "Extending climaemet"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Extending climaemet}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
resource_files:
   - vignettes/example-gif.gif
---



**climaemet** provides several functions for accessing a selection of endpoints of the [AEMET API tool](https://opendata.aemet.es/dist/index.html?). However, this package does not cover in full all the capabilities of the API.

For that reason, we provide the `get_data_aemet()` function, that allows to access any API endpoint freely. The drawback is that the user would need to handle the results by him/herself.


```r
library(climaemet)
```

## Example: Normalized text

Some API endpoints, as **predicciones-normalizadas-texto**, provides the results as plain text on natural language. These results are not parsed by **climaemet**, but can be retrieved as this:


```r
# endpoint, today forecast

today <- "/api/prediccion/nacional/hoy"

# Metadata
knitr::kable(get_metadata_aemet(today))
```



|unidad_generadora                           |descripcion                                                                                                                              |periodicidad                                                                                                                                                                                                               |formato   |copyright                                                                                               |notaLegal                          |
|:-------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:---------|:-------------------------------------------------------------------------------------------------------|:----------------------------------|
|Grupo Funcional de Predicción de Referencia |Predicción general nacional para hoy / mañana / pasado mañana / medio plazo (tercer y cuarto día) / tendencia (del quinto al noveno día) |Disponibilidad. Para hoy, solo se confecciona si hay cambios significativos. Para mañana y pasado mañana diaria a las 15:00 h.o.p.. Para el medio plazo diaria a las 16:00 h.o.p.. La tendencia, diaria a las 18:30 h.o.p. |ascii/txt |© AEMET. Autorizado el uso de la información y su reproducción citando a AEMET como autora de la misma. |https://www.aemet.es/es/nota_legal |

```r

# Data
pred_today <- get_data_aemet(today)
#> 
#> Returning raw results. MIME type: text/plain
```


```r
# Produce a result

clean <- gsub("\r", "\n", pred_today, fixed = TRUE)
clean <- gsub("\n\n\n", "\n", clean, fixed = TRUE)

cat(paste("---\n\n", clean, "\n---"))
```

---

 AGENCIA ESTATAL DE METEOROLOGÍA
PREDICCIÓN GENERAL PARA ESPAÑA 
DÍA 27 DE ENERO DE 2023 A LAS 08:50 HORA OFICIAL
PREDICCIÓN VÁLIDA PARA EL VIERNES 27

A.- FENÓMENOS SIGNIFICATIVOS
Acumulaciones significativas de nieve en el área cantábrica y
norte de los sistemas Central e Ibérico. Heladas generalizadas,
fuertes en Pirineos. Viento fuerte o con rachas muy fuertes en los
litorales de Galicia, Ampurdán, norte de Baleares, Canarias,
Pirineos, sistemas Central e Ibérico y valle del Ebro.

B.- PREDICCIÓN
Predominio de cielos nubosos en los tercios noroeste y norte
peninsulares, con precipitaciones en el nordeste de Galicia y
área cantábrica, donde podrán ser localmente persistentes en
áreas montañosas. También se esperan precipitaciones, débiles
y dispersas en general, en otras zonas del norte de Galicia,
Pirineos, alto Ebro, y norte de la meseta Norte, y sin
descartarlas en los entornos de los sistemas Ibérico y Central.
Intervalos nubosos en Baleares y Alborán con probables chubascos
ocasionales, sin descartarlos en los litorales del sureste
peninsular. Predominio de poco nuboso en el resto del área
mediterránea, y mitad sur peninsular, con intervalos nubosos en
las Béticas. Las cotas de nieve en Pirineos estarán en unos
300/500 m, 600/800 en la Cantábrica occidental, y 400/600 m en el
resto del área cantábrica y sistemas Central e Ibérico. Se
esperan acumulaciones significativas en el área cantábrica,
norte de los sistemas Central e Ibérico y noreste de la meseta
Norte. En Canarias, intervalos nubosos con probabilidad de
precipitaciones débiles durante la segunda mitad del día en el
norte de las islas de mayor relieve. Probables bancos de niebla
matinales en zonas de montaña del tercio norte peninsular. Las
temperaturas tendrán un aumento en la mitad suroeste peninsular,
tanto las máximas como las mínimas, y con pocos cambios o
ligeros descensos en el resto del país. Salvo en el extremo
suroeste, heladas generalizadas en zonas del interior peninsular,
más intensas en montaña y llegando a fuerte en Pirineos. Vientos
del norte y noreste, fuerte en litorales de Galicia, tramontana en
Ampurdán y norte de Baleares, y con intervalos fuertes en
Canarias occidentales. Rachas muy fuertes del noroeste en
Pirineos, sistemas Central e Ibérico y valle del Ebro.

 
---

## Example: Maps

AEMET also provides map data, usually on `image/gif` format. One way to get this kind of data is as follows:


```r
# Endpoint of a map
a_map <- "/api/satelites/producto/nvdi"

# Metadata
knitr::kable(get_metadata_aemet(a_map))
```



|unidad_generadora       |descripción                      |periodicidad |formato   |copyright                                                                                               |notaLegal                          |
|:-----------------------|:--------------------------------|:------------|:---------|:-------------------------------------------------------------------------------------------------------|:----------------------------------|
|Teledetección Satelital |Indice normalizado de vegetación |1 vez al día |image/gif |© AEMET. Autorizado el uso de la información y su reproducción citando a AEMET como autora de la misma. |https://www.aemet.es/es/nota_legal |

```r

the_map <- get_data_aemet(a_map)
#> 
#> Returning raw results. MIME type: image/gif


# Write as gif and include it
giffile <- "example-gif.gif"
writeBin(the_map, giffile)

# Display on the vignette
knitr::include_graphics(giffile)
```

<img src="example-gif.gif" alt="plot of chunk maps" width="100%" />
