---
title: "Extending climaemet"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Extending climaemet}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
resource_files:
   - vignettes/example-gif.gif
---

<!-- extending-climaemet.Rmd is generated from extending-climaemet.Rmd.orig. Please edit that file -->




**climaemet** provides several functions for accessing a selection of endpoints of the [AEMET API tool](https://opendata.aemet.es/dist/index.html?). However, this package does not cover in full all the capabilities of the API.

For that reason, we provide the `get_data_aemet()` function, that allows to access any API endpoint freely. The drawback is that the user would need to handle the results by him/herself.


```r
library(climaemet)
```

## Example: Normalized text

Some API endpoints, as **predicciones-normalizadas-texto**, provides the results as plain text on natural language. These results are not parsed by **climaemet**, but can be retrieved as this:


```r
# endpoint, today forecast

today <- "/api/prediccion/nacional/hoy"

# Metadata
knitr::kable(get_metadata_aemet(today))
```



|unidad_generadora                           |descripcion                                                                                                                              |periodicidad                                                                                                                                                                                                               |formato   |copyright                                                                                               |notaLegal                          |
|:-------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:---------|:-------------------------------------------------------------------------------------------------------|:----------------------------------|
|Grupo Funcional de Predicción de Referencia |Predicción general nacional para hoy / mañana / pasado mañana / medio plazo (tercer y cuarto día) / tendencia (del quinto al noveno día) |Disponibilidad. Para hoy, solo se confecciona si hay cambios significativos. Para mañana y pasado mañana diaria a las 15:00 h.o.p.. Para el medio plazo diaria a las 16:00 h.o.p.. La tendencia, diaria a las 18:30 h.o.p. |ascii/txt |© AEMET. Autorizado el uso de la información y su reproducción citando a AEMET como autora de la misma. |https://www.aemet.es/es/nota_legal |



```r

# Data
pred_today <- get_data_aemet(today)
#> 
#> Returning raw results. MIME type: text/plain
```


```r
# Produce a result

clean <- gsub("\r", "\n", pred_today, fixed = TRUE)
clean <- gsub("\n\n\n", "\n", clean, fixed = TRUE)

cat(paste("---\n\n", clean, "\n---"))
```

---

 AGENCIA ESTATAL DE METEOROLOGÍA
PREDICCIÓN GENERAL PARA ESPAÑA 
DÍA 13 DE DICIEMBRE DE 2023 A LAS 08:44 HORA OFICIAL
PREDICCIÓN VÁLIDA PARA EL MIÉRCOLES 13

A.- FENÓMENOS SIGNIFICATIVOS
Nevadas en Pirineos. Posibles precipitaciones localmente fuertes
en el litoral cantábrico, localmente persistentes en su extremo
oriental. Intervalos de viento fuerte en el Cantábrico, bajo
Ebro, Baleares y Alborán. Calimas en Canarias. Descenso notable
de las temperaturas en montaña y el sudeste.

B.- PREDICCIÓN
Se espera que un frente atlántico termine de atravesar la
Península y Baleares, con nubosidad desplazándose hacia el
sudeste y precipitaciones, débiles y dispersas en general, en el
sur de Aragón, Castilla-La Mancha, Andalucía central y Estrecho,
sin descartar zonas aledañas. Tras el paso del frente tenderá a
abrirse claros y a remitir las precipitaciones. En el extremo
norte y zonas del centro se espera una situación posfrontal, con
cielos nubosos y precipitaciones, más intensas y abundantes en el
litoral cantábrico, donde pueden ser localmente fuertes, incluso
persistentes en su extremo oriental. En el nordeste de Cataluña
chubascos en la segunda mitad del día. En Canarias poco nuboso
tendiendo a nubes altas.

Cotas de nieve: en Pirineos 1800/2200 a primeras horas del día,
descendiendo hasta 1000/1400 m, sin descartar acumular más de 10
cm; en la cordillera Cantábrica, 1000/1400 m, y en los sistemas
Central e Ibérico, entre 1600 y 2000 m al principio descendiendo
a 1000/1400 m.

Son probables calimas en Canarias, tendiendo a disminuir algo en
las islas orientales. También son probables nieblas matinales en
el interior de Andalucía, este de la meseta Sur y Pirineos.

Las temperaturas descenderán acusadamente en la Península, de
forma notable en montaña y en el sudeste. Sin grandes cambios en
el resto. Se esperan heladas en montaña de la mitad norte y del
sudeste de la Península, más intensas en Pirineos donde no se
descarta que lleguen a ser moderadas.

Soplarán vientos de componente oeste rolando a noroeste en la
Península y Baleares, fuertes o con intervalos de fuerte en el
litoral cantábrico, Baleares y Alborán y rachas muy fuertes en
el bajo Ebro. Vientos flojos del este en Canarias, con tendencia a
rolar a nordeste.

 
---

## Example: Maps

AEMET also provides map data, usually on `image/gif` format. One way to get this kind of data is as follows:


```r
# Endpoint of a map
a_map <- "/api/mapasygraficos/analisis"

# Metadata
knitr::kable(get_metadata_aemet(a_map))
```



|unidad_generadora                 |descripción                                |periodicidad                                                                              |formato   |copyright                                                                                               |notaLegal                          |
|:---------------------------------|:------------------------------------------|:-----------------------------------------------------------------------------------------|:---------|:-------------------------------------------------------------------------------------------------------|:----------------------------------|
|Grupo Funcional de Jefes de Turno |Mapas de análisis de frentes en superficie |Dos veces al día, a las 02:00 y 14:00 h.o.p. en invierno y a las 03:00 y 15:00 en verano. |image/gif |© AEMET. Autorizado el uso de la información y su reproducción citando a AEMET como autora de la misma. |https://www.aemet.es/es/nota_legal |



```r

the_map <- get_data_aemet(a_map)
#> 
#> Returning raw results. MIME type: image/gif


# Write as gif and include it
giffile <- "example-gif.gif"
writeBin(the_map, giffile)

# Display on the vignette
knitr::include_graphics(giffile)
```

<div class="figure">
<img src="example-gif.gif" alt="Example: Surface analysis map provided by AEMET" width="100%" />
<p class="caption">Example: Surface analysis map provided by AEMET</p>
</div>
