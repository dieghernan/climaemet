---
title: "Extending climaemet"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Extending climaemet}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
resource_files:
   - vignettes/example-gif.gif
---



**climaemet** provides several functions for accessing a selection of endpoints of the [AEMET API tool](https://opendata.aemet.es/dist/index.html?). However, this package does not cover in full all the capabilities of the API.

For that reason, we provide the `get_data_aemet()` function, that allows to access any API endpoint freely. The drawback is that the user would need to handle the results by him/herself.


```r
library(climaemet)
```

## Example: Normalized text

Some API endpoints, as **predicciones-normalizadas-texto**, provides the results as plain text on natural language. These results are not parsed by **climaemet**, but can be retrieved as this:


```r

# endpoint, today forecast

today <- "/api/prediccion/nacional/hoy"

# Metadata
knitr::kable(get_metadata_aemet(today))
```



|unidad_generadora                           |descripcion                                                                                                                              |periodicidad                                                                                                                                                                                                               |formato   |copyright                                                                                               |notaLegal                          |
|:-------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:---------|:-------------------------------------------------------------------------------------------------------|:----------------------------------|
|Grupo Funcional de Predicción de Referencia |Predicción general nacional para hoy / mañana / pasado mañana / medio plazo (tercer y cuarto día) / tendencia (del quinto al noveno día) |Disponibilidad. Para hoy, solo se confecciona si hay cambios significativos. Para mañana y pasado mañana diaria a las 15:00 h.o.p.. Para el medio plazo diaria a las 16:00 h.o.p.. La tendencia, diaria a las 18:30 h.o.p. |ascii/txt |© AEMET. Autorizado el uso de la información y su reproducción citando a AEMET como autora de la misma. |https://www.aemet.es/es/nota_legal |

```r

# Data
pred_today <- get_data_aemet(today)
#> 
#> Returning raw results. MIME type: text/plain
```


```r

# Produce a result

clean <- gsub("\r", "\n", pred_today, fixed = TRUE)
clean <- gsub("\n\n\n", "\n", clean, fixed = TRUE)

cat(paste("---\n\n", clean, "\n---"))
```

---

 AGENCIA ESTATAL DE METEOROLOGÍA
PREDICCIÓN GENERAL PARA ESPAÑA 
DÍA 06 DE ENERO DE 2023 A LAS 08:36 HORA OFICIAL
PREDICCIÓN VÁLIDA PARA EL VIERNES 6

A.- FENÓMENOS SIGNIFICATIVOS
Probabilidad de chubascos localmente fuertes en el oeste de
Galicia. Rachas de viento muy fuerte en el norte de Galicia a
partir de la tarde. Nieblas localmente persistentes en áreas del
interior peninsular.

B.- PREDICCIÓN
Debido a la aproximación de un frente atlántico, se espera un
aumento de la nubosidad en la mitad oeste de Galicia, con
probabilidad de precipitaciones, al final del día, que podrían
ser localmente fuertes. Intervalos nubosos en el resto de Galicia,
meseta norte, y al principio en el área del Estrecho y zonas del
valle del Ebro, Extremadura y de Castilla-La Mancha. Poco nuboso
en el resto de la Península y Baleares, salvo nieblas localmente
persistentes en áreas del interior peninsular, sobre todo en La
Mancha, Castilla y León y depresiones del nordeste, donde además
pueden ser engelantes. En Canarias, poco nuboso con algunos
intervalos nubosos, sin descartar algún chubasco débil en las
islas de mayor relieve.

Temperaturas diurnas en descenso en zonas del tercio norte
peninsular, y con pocos cambios el resto. Habrá heladas débiles
en ambas mesetas, así como en el sistema Ibérico y en las
montañas del sureste peninsular. Serán algo más intensas en
Pirineos.

Viento de componente este en el Estrecho y Canarias. Del suroeste
y sur en Galicia, Cantábrico y Baleares, con rachas de muy fuerte
en el norte de Galicia a partir de la tarde. Flojo variable en el
resto de la Península.

 
---

## Example: Maps

AEMET also provides map data, usually on `image/gif` format. One way to get this kind of data is as follows:


```r

# Endpoint of a map
a_map <- "/api/satelites/producto/nvdi"

# Metadata
knitr::kable(get_metadata_aemet(a_map))
```



|unidad_generadora       |descripción                      |periodicidad |formato   |copyright                                                                                               |notaLegal                          |
|:-----------------------|:--------------------------------|:------------|:---------|:-------------------------------------------------------------------------------------------------------|:----------------------------------|
|Teledetección Satelital |Indice normalizado de vegetación |1 vez al día |image/gif |© AEMET. Autorizado el uso de la información y su reproducción citando a AEMET como autora de la misma. |https://www.aemet.es/es/nota_legal |

```r

the_map <- get_data_aemet(a_map)
#> 
#> Returning raw results. MIME type: image/gif


# Write as gif and include it
giffile <- "example-gif.gif"
writeBin(the_map, giffile)

# Display on the vignette
knitr::include_graphics(giffile)
```

<img src="example-gif.gif" alt="plot of chunk maps" width="100%" />
