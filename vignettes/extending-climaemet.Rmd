---
title: "Extending climaemet"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Extending climaemet}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
resource_files:
   - vignettes/example-gif.gif
---

<!-- extending-climaemet.Rmd is generated from extending-climaemet.Rmd.orig. Please edit that file -->



**climaemet** provides several functions for accessing a selection of endpoints
of the [AEMET API tool](https://opendata.aemet.es/dist/index.html?). However,
this package does not cover in full all the capabilities of the API.

For that reason, we provide the `get_data_aemet()` function, that allows to
access any API endpoint freely. The drawback is that the user would need to
handle the results by him/herself.


``` r
library(climaemet)
```

## Example: Normalized text

Some API endpoints, as `predicciones-normalizadas-texto`, provides the results
as plain text on natural language. These results are not parsed by
**climaemet**, but can be retrieved as this:


``` r
# endpoint, today forecast

today <- "/api/prediccion/nacional/hoy"

# Metadata
knitr::kable(get_metadata_aemet(today))
```



|unidad_generadora                           |descripcion                                                                                                                              |periodicidad                                                                                                                                                                                                               |formato   |copyright                                                                                               |notaLegal                          |
|:-------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:---------|:-------------------------------------------------------------------------------------------------------|:----------------------------------|
|Grupo Funcional de Predicción de Referencia |Predicción general nacional para hoy / mañana / pasado mañana / medio plazo (tercer y cuarto día) / tendencia (del quinto al noveno día) |Disponibilidad. Para hoy, solo se confecciona si hay cambios significativos. Para mañana y pasado mañana diaria a las 15:00 h.o.p.. Para el medio plazo diaria a las 16:00 h.o.p.. La tendencia, diaria a las 18:30 h.o.p. |ascii/txt |© AEMET. Autorizado el uso de la información y su reproducción citando a AEMET como autora de la misma. |https://www.aemet.es/es/nota_legal |



``` r

# Data
pred_today <- get_data_aemet(today)
#> 
#> Results are MIME type: text/plain
#> Returning data as string
```


``` r
# Produce a result

clean <- gsub("\r", "\n", pred_today, fixed = TRUE)
clean <- gsub("\n\n\n", "\n", clean, fixed = TRUE)

cat(paste("---\n\n", clean, "\n---"))
```

---

 AGENCIA ESTATAL DE METEOROLOGÍA
PREDICCIÓN GENERAL PARA ESPAÑA 
DÍA 27 DE AGOSTO DE 2024 A LAS 09:13 HORA OFICIAL
PREDICCIÓN VÁLIDA PARA EL MARTES 27

A.- FENÓMENOS SIGNIFICATIVOS
No se descartan chubascos localmente fuertes en el Pirineo
oriental. Ascenso localmente notable de las máximas en el Alto
Ebro.

B.- PREDICCIÓN
Predominio de un tiempo estable en la Península y Baleares con
cielos poco nubosos o despejados y algunos intervalos de nubes
altas. Únicamente en el oeste de Galicia, Cantábrico oriental y
zonas del litoral de Cataluña y del interior sureste se prevé
nubosidad baja matinal, con probables brumas y bancos de niebla.
Asimismo se espera nubosidad, de forma más compacta, en el
Estrecho y Alborán, sin descartar alguna lluvia débil y dispersa
en el Estrecho y en Melilla. Por la tarde se desarrollará
nubosidad de evolución en el tercio este peninsular, así como en
montañas del sur, con probabilidad de chubascos y tormentas
ocasionales en el Pirineo e Ibérica orientales así como en las
sierras del sureste, algo más probables en el entorno de Sierra
Nevada. En Pirineos no se descarta que sean localmente fuertes.
Intervalos nubosos de tipo bajo en los nortes y de medio y alto en
el resto de Canarias, sin descartar chubascos, e incluso
tormentas, en el interior de Tenerife. Tampoco se descartan
calimas débiles en Canarias y sur peninsular.

Las temperaturas máximas aumentarán en la mitad nordeste
peninsular y norte de Baleares, localmente notable en el Alto Ebro
y con descensos en el oeste de la Península. Se espera superar
los 35 grados en amplias zona de interior de la mitad sur
peninsular, sin descartarlos en las depresiones del nordeste y en
la meseta norte, y sin descartar tampoco llegar a los 38 en puntos
del Guadalquivir. Las mínimas aumentarán en la mitad norte, sin
grandes cambios en el resto. En Canarias, máximas en descenso y
mínimas con pocos cambios.

Predominarán los vientos de componentes sur y este en la
vertiente mediterránea peninsular y Baleares, con tramontana
soplando al principio en Ampurdán y norte del archipiélago.
Vientos de componente este rolando a oeste en el Cantábrico, y
predominio de la componente oeste en el resto. En Canarias
soplarán alisos moderados.

 
---

## Example: Maps

AEMET also provides map data, usually on `image/gif` format. One way to get this
kind of data is as follows:


``` r
# Endpoint of a map
a_map <- "/api/mapasygraficos/analisis"

# Metadata
knitr::kable(get_metadata_aemet(a_map))
```



|unidad_generadora                 |descripción                                |periodicidad                                                                              |formato   |copyright                                                                                               |notaLegal                          |
|:---------------------------------|:------------------------------------------|:-----------------------------------------------------------------------------------------|:---------|:-------------------------------------------------------------------------------------------------------|:----------------------------------|
|Grupo Funcional de Jefes de Turno |Mapas de análisis de frentes en superficie |Dos veces al día, a las 02:00 y 14:00 h.o.p. en invierno y a las 03:00 y 15:00 en verano. |image/gif |© AEMET. Autorizado el uso de la información y su reproducción citando a AEMET como autora de la misma. |https://www.aemet.es/es/nota_legal |



``` r

the_map <- get_data_aemet(a_map)
#> 
#> Results are MIME type: image/gif
#> Returning raw data


# Write as gif and include it
giffile <- "example-gif.gif"
writeBin(the_map, giffile)

# Display on the vignette
knitr::include_graphics(giffile)
```

<div class="figure">
<img src="example-gif.gif" alt="Example: Surface analysis map provided by AEMET" width="100%" />
<p class="caption">Example: Surface analysis map provided by AEMET</p>
</div>
