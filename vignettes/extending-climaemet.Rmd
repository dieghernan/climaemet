---
title: "Extending climaemet"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Extending climaemet}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
resource_files:
   - vignettes/example-gif.gif
---



**climaemet** provides several functions for accessing a selection of endpoints of the [AEMET API tool](https://opendata.aemet.es/dist/index.html?). However, this package does not cover in full all the capabilities of the API.

For that reason, we provide the `get_data_aemet()` function, that allows to access any API endpoint freely. The drawback is that the user would need to handle the results by him/herself.


```r
library(climaemet)
```

## Example: Normalized text

Some API endpoints, as **predicciones-normalizadas-texto**, provides the results as plain text on natural language. These results are not parsed by **climaemet**, but can be retrieved as this:


```r
# endpoint, today forecast

today <- "/api/prediccion/nacional/hoy"

# Metadata
knitr::kable(get_metadata_aemet(today))
```



|unidad_generadora                           |descripcion                                                                                                                              |periodicidad                                                                                                                                                                                                               |formato   |copyright                                                                                               |notaLegal                          |
|:-------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:---------|:-------------------------------------------------------------------------------------------------------|:----------------------------------|
|Grupo Funcional de Predicción de Referencia |Predicción general nacional para hoy / mañana / pasado mañana / medio plazo (tercer y cuarto día) / tendencia (del quinto al noveno día) |Disponibilidad. Para hoy, solo se confecciona si hay cambios significativos. Para mañana y pasado mañana diaria a las 15:00 h.o.p.. Para el medio plazo diaria a las 16:00 h.o.p.. La tendencia, diaria a las 18:30 h.o.p. |ascii/txt |© AEMET. Autorizado el uso de la información y su reproducción citando a AEMET como autora de la misma. |https://www.aemet.es/es/nota_legal |



```r

# Data
pred_today <- get_data_aemet(today)
#> 
#> Returning raw results. MIME type: text/plain
```


```r
# Produce a result

clean <- gsub("\r", "\n", pred_today, fixed = TRUE)
clean <- gsub("\n\n\n", "\n", clean, fixed = TRUE)

cat(paste("---\n\n", clean, "\n---"))
```

---

 AGENCIA ESTATAL DE METEOROLOGÍA
PREDICCIÓN GENERAL PARA ESPAÑA 
DÍA 31 DE JULIO DE 2023 A LAS 08:32 HORA OFICIAL
PREDICCIÓN VÁLIDA PARA EL LUNES 31

A.- FENÓMENOS SIGNIFICATIVOS
Temperaturas significativamente altas en la mitad sur peninsular,
medio Ebro, depresiones del nordeste y Canarias.

B.- PREDICCIÓN
En gran parte del país predominarán cielos poco nubosos. No
obstante, se formará nubosidad de evolución en el tercio
oriental interior, con probabilidad de chubascos en el Pirineo
oriental, sin descartarlos de forma dispersa en otras zonas
interiores de Cataluña, interior de Valencia y en la Ibérica
oriental. También se prevén nubes bajas matinales en el área
mediterránea oriental, sin descartar precipitaciones aisladas en
el sur de Valencia, norte de Alicante y oeste de Baleares.
Asimismo, en el Cantábrico podrían darse intervalos de nubes
bajas dispersas, y en el oeste de Galicia tenderá a nublarse al
final, con una pequeña probabilidad de precipitaciones débiles
en el noroeste de Galicia al final del día. En Canarias,
intervalos de nubes bajas en el norte de las islas de mayor
relieve y nubosidad media y alta en las islas occidentales.

Probables calimas altas en Canarias, sin descartarlas en Melilla.
No se descartan nieblas matinales dispersas en zonas interiores de
Galicia, este de la meseta Sur y Cádiz. Probables nieblas
costeras en el litoral de la Andalucía mediterránea.

Las temperaturas máximas aumentarán en Canarias y en el tercio
norte de la Península y descenderán en el tercio sur. Se pueden
superar los 34-36 grados en el interior de la mitad sur peninsular
y en zonas de Canarias, incluso los 38-40 en el Guadalquivir. Las
mínimas descenderán en el nordeste. No bajarán de 24-26 grados
en litorales de la Comunidad Valenciana y en puntos de Andalucía.

Se esperan vientos de componente oeste en la vertiente atlántica,
área del Estrecho y medio Ebro, y predominará la componente este
en el área mediterránea. Alisios en Canarias, con rachas muy
fuertes en los canales entre islas.

 
---

## Example: Maps

AEMET also provides map data, usually on `image/gif` format. One way to get this kind of data is as follows:


```r
# Endpoint of a map
a_map <- "/api/mapasygraficos/analisis"

# Metadata
knitr::kable(get_metadata_aemet(a_map))
```



|unidad_generadora                 |descripción                                |periodicidad                                                                              |formato   |copyright                                                                                               |notaLegal                          |
|:---------------------------------|:------------------------------------------|:-----------------------------------------------------------------------------------------|:---------|:-------------------------------------------------------------------------------------------------------|:----------------------------------|
|Grupo Funcional de Jefes de Turno |Mapas de análisis de frentes en superficie |Dos veces al día, a las 02:00 y 14:00 h.o.p. en invierno y a las 03:00 y 15:00 en verano. |image/gif |© AEMET. Autorizado el uso de la información y su reproducción citando a AEMET como autora de la misma. |https://www.aemet.es/es/nota_legal |



```r

the_map <- get_data_aemet(a_map)
#> 
#> Returning raw results. MIME type: image/gif


# Write as gif and include it
giffile <- "example-gif.gif"
writeBin(the_map, giffile)

# Display on the vignette
knitr::include_graphics(giffile)
```

<div class="figure">
<img src="example-gif.gif" alt="Example: Surface analysis map provided by AEMET" width="100%" />
<p class="caption">Example: Surface analysis map provided by AEMET</p>
</div>
