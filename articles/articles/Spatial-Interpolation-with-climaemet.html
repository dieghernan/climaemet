<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spatial Interpolation with climaemet • climaemet</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- Google Fonts --><link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono&amp;family=Roboto:wght@100;300;400;500;700&amp;display=swap" rel="stylesheet">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><!-- Hugo Universal --><link href="../../style.violet.css" rel="stylesheet">
<!-- rOpenSpain --><link href="../../ropenspain.css" rel="stylesheet">
<meta property="og:title" content="Spatial Interpolation with climaemet">
<meta property="og:description" content="climaemet">
<meta property="og:image" content="https://ropenspain.github.io/climaemet/logo.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@mpizarrozgz">
<meta name="twitter:site" content="@rOpenSpain">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed btn-template-main" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
      <span class="sr-only">Toggle navigation</span>
      <i class="fa fa-align-justify"></i>
      </button>
      <span class="navbar-brand" id="ROS-navbar-brand">
      <a class="navbar-link ROS-black" href="../../index.html"><img src="../../logo.png" alt="climaemet-logo" id="ROS-navbar-logo">climaemet</a> <span class="version label label-default hidden-xs" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0.9000</span>
      </span>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../articles/climaemet.html">Get started</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/articles/Spatial-Interpolation-with-climaemet.html">Spatial Interpolation with climaemet</a>
    </li>
    <li>
      <a href="../../articles/articles/dealing_spatial.html">Dealing with spatial data</a>
    </li>
    <li>
      <a href="../../articles/articles/x01_aemet_stations.html">AEMET Stations</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/rOpenSpain/climaemet/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>  <!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->


      

      </header><script src="Spatial-Interpolation-with-climaemet_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Spatial Interpolation with climaemet</h1>
                        <h4 class="author">Diego Hernangómez</h4>
                        <h4 class="author">Manuel Pizarro</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rOpenSpain/climaemet/blob/master/vignettes/articles/Spatial-Interpolation-with-climaemet.Rmd"><code>vignettes/articles/Spatial-Interpolation-with-climaemet.Rmd</code></a></small>
      <div class="hidden name"><code>Spatial-Interpolation-with-climaemet.Rmd</code></div>

    </div>

    
    
<p><strong>climaemet</strong> can retrieve data from the stations included on <a href="https://opendata.aemet.es/centrodedescargas/inicio">AEMET Open Data</a>. However, in terms of spatial analysis and visualization, it can be useful to extend the data from points (stations) to the whole extent of Spain. On this article we would explain a method to interpolate the climatic data trough <a href="https://docs.qgis.org/3.16/en/docs/gentle_gis_introduction/spatial_analysis_interpolation.html">Spatial Interpolation</a>, that is the process of using points with known values to estimate values at other unknown points.</p>
<div id="initial-config" class="section level2">
<h2 class="hasAnchor">
<a href="#initial-config" class="anchor"></a>Initial config</h2>
<p>For this analysis, we would need the following libraries:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ropenspain.github.io/climaemet/">climaemet</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ropenspain.github.io/mapSpain/">mapSpain</a></span><span class="op">)</span> <span class="co"># Base maps of Spain</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster">raster</a></span><span class="op">)</span> <span class="co"># raster handling</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span> <span class="co"># spatial shape handling</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/gstat/">gstat</a></span><span class="op">)</span> <span class="co"># for spatial interpolation</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span> <span class="co"># data handling</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span> <span class="co"># for plots</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://gif.ski/">gifski</a></span><span class="op">)</span> <span class="co"># we would create an animation</span></code></pre></div>
</div>
<div id="retrieving-data" class="section level2">
<h2 class="hasAnchor">
<a href="#retrieving-data" class="anchor"></a>Retrieving data</h2>
<p>We choose here the daily climatic data from Winter 2020-2021 in Spain. Note that on the first half of January, <a href="https://en.wikipedia.org/wiki/Storm_Filomena">Storm Filomena</a> brought unusual heavy snowfall to parts of Spain, with Madrid recording its heaviest snowfall since 1971. We should be able to spot that.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">clim_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/aemet_daily_clim.html">aemet_daily_clim</a></span><span class="op">(</span>
  start <span class="op">=</span> <span class="st">"2020-12-21"</span>,
  end <span class="op">=</span> <span class="st">"2021-03-20"</span>,
  return_sf <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>

<span class="va">clim_data_clean</span> <span class="op">&lt;-</span> <span class="va">clim_data</span> <span class="op">%&gt;%</span>
  <span class="co"># Exclude Canary Islands from analysis</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">provincia</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"LAS PALMAS"</span>, <span class="st">"STA. CRUZ DE TENERIFE"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">fecha</span>, <span class="va">tmed</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># Exclude NAs</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">tmed</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">clim_data_clean</span><span class="op">$</span><span class="va">tmed</span><span class="op">)</span>
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">#&gt; -15.200   6.100   9.500   8.877  12.200  25.000</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">clim_data_clean</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="Spatial-Interpolation-with-climaemet_files/figure-html/climatic_data-1.png" width="700"></p>
<p>We load also a basic shapefile of Spain using <strong>mapSpain</strong>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">CCAA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ropenspain.github.io/mapSpain/reference/esp_get_ccaa.html">esp_get_ccaa</a></span><span class="op">(</span>epsg <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># Exclude Canary Islands from analysis</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">ine.ccaa.name</span> <span class="op">!=</span> <span class="st">"Canarias"</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">CCAA</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">clim_data_clean</span><span class="op">)</span></code></pre></div>
<p><img src="Spatial-Interpolation-with-climaemet_files/figure-html/geo_data-1.png" width="700"></p>
<p>As it can be seed, the climatic data we have available so far is restricted to the stations (points), but we want to extend these values to the whole territory.</p>
</div>
<div id="filling-the-gaps-interpolation" class="section level2">
<h2 class="hasAnchor">
<a href="#filling-the-gaps-interpolation" class="anchor"></a>Filling the gaps: Interpolation</h2>
<p>As we need to predict values at locations where no measurements have been made, we would need to interpolate the data. On this example we would apply the <a href="https://rspatial.org/raster/analysis/4-interpolation.html#inverse-distance-weighted">Inverse Distance Weighted method</a>, that is one of several approaches to perform spatial interpolation. We recommend <a href="https://rspatial.org/raster/analysis/4-interpolation.html">this article</a> on how to perform these analysis on <strong>R</strong>.</p>
<p>The process would be as follow:</p>
<ul>
<li>Create an spatial object (grid) where the predicted values would be applied.</li>
<li>Perform an spatial interpolation.</li>
<li>Visualize the results.</li>
</ul>
<div id="creating-a-grid" class="section level3">
<h3 class="hasAnchor">
<a href="#creating-a-grid" class="anchor"></a>Creating a grid</h3>
<p>For this analysis, we need a destination object with the locations to be predicted. A common technique is to create a spatial grid (a “raster”) covering the targeted locations.</p>
<p>On this example, we would use <strong>sf</strong> to create a regular grid that would be converted into a <strong>raster</strong>.</p>
<p><strong>An important thing to consider in any spatial analysis or visualization</strong> is the <a href="https://en.wikipedia.org/wiki/Spatial_reference_system">coordinate reference system (CRS)</a>. We won’t cover this in detail on this article, but we should mention a few key considerations:</p>
<ul>
<li>When using several spatial objects, we should ensure that <strong>all of them present the same CRS</strong>. This can be achieved projecting the objects (i.e. transforming their coordinates) to the same CRS.</li>
<li>Longitude/latitude coordinates are unprojected coordinates. When we project an object (i.e. Mercator projection) we actually change the values of every point (x,y) coordinates (i.e. a projection is a transformation of the coordinates.)</li>
<li>For measuring distance in meters, etc. we should choose the right projection. Distances on unprojected coordinates are meaningless. Think that 1 degree of longitude on the equator means 111 kms but on the North Pole means roughly 0.11 m. The degrees just split a circumference on equally spaced buckets, but the Earth is an spheroid and the circumferences at different latitudes doesn’t have the same length (opposed to a cylinder, where circumferences are the same at any latitude or y-axis.)</li>
</ul>
<p>On this exercise, we choose to project our objects to <strong>ETRS89 / UTM zone 30N</strong> <a href="https://epsg.io/25830">EPSG:25830</a>, that provides x and y values on meters and maximizes the accuracy for Spain.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">clim_data_utm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">clim_data_clean</span>, <span class="fl">25830</span><span class="op">)</span>
<span class="va">CCAA_utm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">CCAA</span>, <span class="fl">25830</span><span class="op">)</span>

<span class="co"># Note the original projection</span>

<span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">CCAA</span><span class="op">)</span><span class="op">$</span><span class="va">proj4string</span>
<span class="co">#&gt; [1] "+proj=longlat +datum=WGS84 +no_defs"</span>
<span class="co"># vs the utm projection</span>

<span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">CCAA_utm</span><span class="op">)</span><span class="op">$</span><span class="va">proj4string</span>
<span class="co">#&gt; [1] "+proj=utm +zone=30 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"</span></code></pre></div>
<p>Now, we create a regular grid using <strong>sf</strong>. This grid is composed to equally spaced points over the whole extent (bounding box) of Spain.</p>
<p>We use here a density of 5000 (m), so the grid density is 5 x 5 kms (25 km2):</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create grid 5*5 km (25 km2)</span>

<span class="va">grd_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html">st_as_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="va">CCAA_utm</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_make_grid.html">st_make_grid</a></span><span class="op">(</span>cellsize <span class="op">=</span> <span class="fl">5000</span>, what <span class="op">=</span> <span class="st">"centers"</span><span class="op">)</span>

<span class="co"># Number of points</span>

<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">grd_sf</span><span class="op">)</span>
<span class="co">#&gt; [1] 44426</span>
<span class="co"># Convert to sp object - interpolation should be made with sp/raster</span>
<span class="va">grd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/coerce-methods.html">as</a></span><span class="op">(</span><span class="va">grd_sf</span>, <span class="st">"Spatial"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/coerce-methods.html">as</a></span><span class="op">(</span><span class="st">"SpatialPixels"</span><span class="op">)</span></code></pre></div>
</div>
<div id="interpolating-the-data" class="section level3">
<h3 class="hasAnchor">
<a href="#interpolating-the-data" class="anchor"></a>Interpolating the data</h3>
<p>Now we just need to populate the (empty) grid with the predicted values based on the observations:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Test with a single day</span>

<span class="va">test_day</span> <span class="op">&lt;-</span> <span class="va">clim_data_utm</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">fecha</span> <span class="op">==</span> <span class="st">"2021-01-08"</span><span class="op">)</span>

<span class="co"># Interpolate temp</span>

<span class="va">interp_temp</span> <span class="op">&lt;-</span> <span class="fu">gstat</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gstat/man/krige.html">idw</a></span><span class="op">(</span><span class="va">tmed</span> <span class="op">~</span> <span class="fl">1</span>,
  <span class="co"># Formula interpolation</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/coerce-methods.html">as</a></span><span class="op">(</span><span class="va">test_day</span>, <span class="st">"Spatial"</span><span class="op">)</span>,
  <span class="co"># Origin</span>
  newdata <span class="op">=</span> <span class="va">grd</span>,
  <span class="co"># Destination</span>
  idp <span class="op">=</span> <span class="fl">2.0</span>
<span class="op">)</span>
<span class="co">#&gt; [inverse distance weighted interpolation]</span>
<span class="co"># To raster and mask the grid to the shape of Spain</span>
<span class="va">interp_temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html">raster</a></span><span class="op">(</span><span class="va">interp_temp</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/mask.html">mask</a></span><span class="op">(</span><span class="va">CCAA_utm</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">interp_temp</span>, axes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><img src="Spatial-Interpolation-with-climaemet_files/figure-html/interpolate-1.png" width="700"></p>
<p>Let’s create a nice ggplot2 plot!</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Making a nice plot on ggplot2</span>
<span class="va">temp_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">interp_temp</span>, xy <span class="op">=</span> <span class="cn">TRUE</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">temp_values</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"temp"</span><span class="op">)</span>

<span class="co"># Get min and max from interpolated values</span>
<span class="va">min_temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">temp_values</span><span class="op">$</span><span class="va">temp</span><span class="op">)</span><span class="op">)</span>
<span class="va">max_temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">temp_values</span><span class="op">$</span><span class="va">temp</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">CCAA_utm</span>, fill <span class="op">=</span> <span class="st">"grey95"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">temp_values</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">temp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradientn</a></span><span class="op">(</span>
    colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">hcl.colors</a></span><span class="op">(</span><span class="fl">11</span>, <span class="st">"Spectral"</span>, rev <span class="op">=</span> <span class="cn">TRUE</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span>,
    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">min_temp</span>, <span class="va">max_temp</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"Avg. Temperature in Spain"</span>,
    subtitle <span class="op">=</span> <span class="st">"2021-01-08"</span>,
    caption <span class="op">=</span> <span class="st">"Data: AEMET, IGN"</span>,
    fill <span class="op">=</span> <span class="st">"C"</span>
  <span class="op">)</span></code></pre></div>
<p><img src="Spatial-Interpolation-with-climaemet_files/figure-html/ggplot_interpolate-1.png" width="700"></p>
</div>
</div>
<div id="animation" class="section level2">
<h2 class="hasAnchor">
<a href="#animation" class="anchor"></a>Animation</h2>
<p>On this section, we would loop over the dates to create a final animation to observe the evolution of temperature through the winter of 2020/21.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Extending and animating</span>
<span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/unique.html">unique</a></span><span class="op">(</span><span class="va">clim_data_clean</span><span class="op">$</span><span class="va">fecha</span><span class="op">)</span><span class="op">)</span>


<span class="co"># Loop through days and interpolate</span>

<span class="va">interp_res</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">dates</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">thisdate</span> <span class="op">&lt;-</span> <span class="va">dates</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
  <span class="va">tmp_day</span> <span class="op">&lt;-</span> <span class="va">clim_data_utm</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">fecha</span> <span class="op">==</span> <span class="va">thisdate</span><span class="op">)</span>

  <span class="va">interp_day</span> <span class="op">&lt;-</span>
    <span class="fu">gstat</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gstat/man/krige.html">idw</a></span><span class="op">(</span><span class="va">tmed</span> <span class="op">~</span> <span class="fl">1</span>,
      <span class="fu"><a href="https://r-spatial.github.io/sf/reference/coerce-methods.html">as</a></span><span class="op">(</span><span class="va">tmp_day</span>, <span class="st">"Spatial"</span><span class="op">)</span>,
      newdata <span class="op">=</span> <span class="va">grd</span>,
      idp <span class="op">=</span> <span class="fl">2.0</span>
    <span class="op">)</span>

  <span class="va">interp_day</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html">raster</a></span><span class="op">(</span><span class="va">interp_day</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/mask.html">mask</a></span><span class="op">(</span><span class="va">CCAA_utm</span><span class="op">)</span>


  <span class="va">interp_day</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">interp_day</span>, xy <span class="op">=</span> <span class="cn">TRUE</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">interp_day</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"temp"</span><span class="op">)</span>
  <span class="va">interp_day</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">nrow</a></span><span class="op">(</span><span class="va">interp_day</span><span class="op">)</span><span class="op">)</span> <span class="co"># We would need the id later</span>
  <span class="va">interp_day</span><span class="op">$</span><span class="va">fecha</span> <span class="op">&lt;-</span> <span class="va">thisdate</span>

  <span class="va">interp_res</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">interp_res</span>, <span class="va">interp_day</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Now we loop through the interpolated results again to create the animation:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Extending and animating</span>

<span class="co"># File array</span>
<span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"frame_"</span>, <span class="va">dates</span>, <span class="st">".png"</span><span class="op">)</span>
<span class="va">file_array</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">files</span><span class="op">)</span>


<span class="va">min_temp2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">interp_res</span><span class="op">$</span><span class="va">temp</span><span class="op">)</span><span class="op">)</span>
<span class="va">max_temp2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">interp_res</span><span class="op">$</span><span class="va">temp</span><span class="op">)</span><span class="op">)</span>


<span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">dates</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">today</span> <span class="op">&lt;-</span> <span class="va">dates</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>

  <span class="va">temp_values</span> <span class="op">&lt;-</span> <span class="va">interp_res</span><span class="op">[</span><span class="va">interp_res</span><span class="op">$</span><span class="va">fecha</span> <span class="op">==</span> <span class="va">today</span>, <span class="op">]</span>
  <span class="va">gg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">temp_values</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">temp_values</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">temp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">CCAA_utm</span>, fill <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradientn</a></span><span class="op">(</span>
      colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">hcl.colors</a></span><span class="op">(</span><span class="fl">11</span>, <span class="st">"Spectral"</span>, rev <span class="op">=</span> <span class="cn">TRUE</span>, alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span>,
      limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">min_temp2</span>, <span class="va">max_temp2</span><span class="op">)</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>
      title <span class="op">=</span> <span class="st">"Avg. Temperature in Spain"</span>,
      subtitle <span class="op">=</span> <span class="va">today</span>,
      caption <span class="op">=</span> <span class="st">"Data: AEMET, IGN"</span>,
      fill <span class="op">=</span> <span class="st">"C"</span>
    <span class="op">)</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">file_array</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>,
    plot <span class="op">=</span> <span class="va">gg</span>,
    width <span class="op">=</span> <span class="fl">8.28</span>,
    height <span class="op">=</span> <span class="fl">7.33</span>
  <span class="op">)</span>
<span class="op">}</span>



<span class="co"># Create animation</span>
<span class="va">tempgif</span> <span class="op">&lt;-</span> <span class="st">"winter_2021.gif"</span>
<span class="fu"><a href="https://rdrr.io/pkg/gifski/man/gifski.html">gifski</a></span><span class="op">(</span>
  <span class="va">file_array</span>,
  <span class="va">tempgif</span>,
  width <span class="op">=</span> <span class="fl">800</span>,
  height <span class="op">=</span> <span class="fl">700</span>,
  loop <span class="op">=</span> <span class="cn">FALSE</span>,
  delay <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">3</span>
<span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># From cache</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span><span class="op">(</span><span class="st">"winter_2021.gif"</span><span class="op">)</span></code></pre></div>
<p><img src="winter_2021.gif"><!-- --></p>
</div>
<div id="geogrid" class="section level2">
<h2 class="hasAnchor">
<a href="#geogrid" class="anchor"></a>Geogrid</h2>
<p>Let’s plot an histogram for each Autonomous Community using the <code>geofacet</code> package:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hafen/geofacet">geofacet</a></span><span class="op">)</span>

<span class="va">clim_data_geofacet</span> <span class="op">&lt;-</span> <span class="va">clim_data</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/select.html">select</a></span><span class="op">(</span><span class="va">fecha</span>, <span class="va">tmed</span>, <span class="va">provincia</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">tmed</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Paste Province info and codes</span>
<span class="va">clim_data_mean</span> <span class="op">&lt;-</span> <span class="va">clim_data_geofacet</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>name_norm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span>
    <span class="va">provincia</span> <span class="op">==</span> <span class="st">"STA. CRUZ DE TENERIFE"</span>,
    <span class="st">"Santa Cruz de Tenerife"</span>,
    <span class="va">provincia</span>
  <span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>name_norm <span class="op">=</span> <span class="fu"><a href="https://ropenspain.github.io/mapSpain/reference/esp_dict.html">esp_dict_translate</a></span><span class="op">(</span><span class="va">name_norm</span>, <span class="st">"es"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>cpro <span class="op">=</span> <span class="fu"><a href="https://ropenspain.github.io/mapSpain/reference/esp_dict.html">esp_dict_region_code</a></span><span class="op">(</span><span class="va">name_norm</span>, destination <span class="op">=</span> <span class="st">"cpro"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Paste CCAA codes and names</span>
<span class="va">clim_data_mean</span> <span class="op">&lt;-</span> <span class="va">clim_data_mean</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">esp_codelist</span>, by <span class="op">=</span> <span class="st">"cpro"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">fecha</span>, <span class="va">ine.ccaa.name</span>, <span class="va">codauto</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>
    mean_tmed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">tmed</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
    obs <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,
    .groups <span class="op">=</span> <span class="st">"keep"</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>code <span class="op">=</span> <span class="va">codauto</span><span class="op">)</span>

<span class="co"># Label the grid with shortnames</span>
<span class="va">ccaagrid</span> <span class="op">&lt;-</span> <span class="fu">geofacet</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/geofacet/man/grids.html">spain_ccaa_grid1</a></span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">esp_codelist</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"codauto"</span>, <span class="st">"ccaa.shortname.es"</span><span class="op">)</span><span class="op">]</span>,
    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"code"</span> <span class="op">=</span> <span class="st">"codauto"</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>name <span class="op">=</span> <span class="va">ccaa.shortname.es</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">ccaa.shortname.es</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Abbrev.</span>
<span class="va">ccaagrid</span><span class="op">$</span><span class="va">name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"Comunidad"</span>, <span class="st">"C."</span>, <span class="va">ccaagrid</span><span class="op">$</span><span class="va">name</span><span class="op">)</span>

<span class="co"># Plot</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">clim_data_mean</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">fecha</span>, <span class="va">mean_tmed</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># Line on Filomena peak</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>
    xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2021-01-08"</span><span class="op">)</span>,
    colour <span class="op">=</span> <span class="st">"red"</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/geofacet/man/facet_geo.html">facet_geo</a></span><span class="op">(</span><span class="op">~</span><span class="va">code</span>,
    grid <span class="op">=</span> <span class="va">ccaagrid</span>,
    scales <span class="op">=</span> <span class="st">"fixed"</span>,
    label <span class="op">=</span> <span class="st">"name"</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Mean Temperature"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
    strip.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,
    axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>
      color <span class="op">=</span> <span class="st">"grey20"</span>,
      size <span class="op">=</span> <span class="fl">5</span>,
      angle <span class="op">=</span> <span class="fl">90</span>,
      hjust <span class="op">=</span> <span class="fl">.5</span>,
      vjust <span class="op">=</span> <span class="fl">.5</span>,
      face <span class="op">=</span> <span class="st">"plain"</span>
    <span class="op">)</span>,
    axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>
      color <span class="op">=</span> <span class="st">"grey20"</span>,
      size <span class="op">=</span> <span class="fl">5</span>,
      angle <span class="op">=</span> <span class="fl">0</span>,
      hjust <span class="op">=</span> <span class="fl">1</span>,
      vjust <span class="op">=</span> <span class="fl">0</span>,
      face <span class="op">=</span> <span class="st">"plain"</span>
    <span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<p><img src="Spatial-Interpolation-with-climaemet_files/figure-html/geofacet-1.png" width="700"></p>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<p>This article is partially based on <a href="https://dominicroye.github.io/en/2020/climate-animation-of-maximum-temperatures/">Climate animation of maximum temperatures</a> by Dominic Royé.</p>
</div>
<div id="session-info" class="section level2">
<h2 class="hasAnchor">
<a href="#session-info" class="anchor"></a>Session Info</h2>
<details><p><summary><strong>Details</strong> </summary></p>
<pre><code>#&gt; R version 4.1.1 (2021-08-10)
#&gt; Platform: x86_64-pc-linux-gnu (64-bit)
#&gt; Running under: Ubuntu 20.04.3 LTS
#&gt; 
#&gt; Matrix products: default
#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.9.0
#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.9.0
#&gt; 
#&gt; locale:
#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       
#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   
#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          
#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   
#&gt; 
#&gt; attached base packages:
#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     
#&gt; 
#&gt; other attached packages:
#&gt;  [1] geofacet_0.2.0       gifski_1.4.3-1       ggplot2_3.3.5       
#&gt;  [4] dplyr_1.0.7          gstat_2.0-7          sf_1.0-2            
#&gt;  [7] raster_3.4-13        sp_1.4-5             mapSpain_0.3.1      
#&gt; [10] climaemet_1.0.0.9000
#&gt; 
#&gt; loaded via a namespace (and not attached):
#&gt;  [1] rnaturalearth_0.1.0 httr_1.4.2          jsonlite_1.7.2     
#&gt;  [4] assertthat_0.2.1    countrycode_1.3.0   highr_0.9          
#&gt;  [7] ggrepel_0.9.1       yaml_2.2.1          pillar_1.6.2       
#&gt; [10] lattice_0.20-45     glue_1.4.2          digest_0.6.27      
#&gt; [13] colorspace_2.0-2    htmltools_0.5.2     pkgconfig_2.0.3    
#&gt; [16] s2_1.0.6            purrr_0.3.4         scales_1.1.1       
#&gt; [19] intervals_0.15.2    jpeg_0.1-9          tzdb_0.1.2         
#&gt; [22] tibble_3.1.4        proxy_0.4-26        generics_0.1.0     
#&gt; [25] farver_2.1.0        ellipsis_0.3.2      cachem_1.0.6       
#&gt; [28] withr_2.4.2         magrittr_2.0.1      crayon_1.4.1       
#&gt; [31] memoise_2.0.0       evaluate_0.14       fs_1.5.0           
#&gt; [34] fansi_0.5.0         xts_0.12.1          class_7.3-19       
#&gt; [37] FNN_1.1.3           textshaping_0.3.5   imguR_1.0.3        
#&gt; [40] tools_4.1.1         hms_1.1.0           lifecycle_1.0.0    
#&gt; [43] stringr_1.4.0       geogrid_0.1.1       munsell_0.5.0      
#&gt; [46] compiler_4.1.1      pkgdown_1.6.1       jquerylib_0.1.4    
#&gt; [49] e1071_1.7-9         spacetime_1.2-5     systemfonts_1.0.2  
#&gt; [52] rlang_0.4.11        classInt_0.4-3      units_0.7-2        
#&gt; [55] grid_4.1.1          rappdirs_0.3.3      labeling_0.4.2     
#&gt; [58] rmarkdown_2.11      wk_0.5.0            gtable_0.3.0       
#&gt; [61] codetools_0.2-18    DBI_1.1.1           curl_4.3.2         
#&gt; [64] R6_2.5.1            gridExtra_2.3       zoo_1.8-9          
#&gt; [67] lubridate_1.7.10    knitr_1.34          rgeos_0.5-7        
#&gt; [70] fastmap_1.1.0       utf8_1.2.2          rprojroot_2.0.2    
#&gt; [73] ragg_1.1.3          KernSmooth_2.23-20  readr_2.0.1        
#&gt; [76] desc_1.3.0          stringi_1.7.4       Rcpp_1.0.7         
#&gt; [79] png_0.1-7           vctrs_0.3.8         tidyselect_1.1.1   
#&gt; [82] xfun_0.26</code></pre>
</details>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>




      <footer id="footer"><div class="container">
		<div class="col-md-3 col-sm-6 col-md-offset-1">
			<h4 data-toc-skip>About climaemet</h4>
			Developed by <a href="https://github.com/mpizarrotig">Manuel Pizarro</a>, <a href="https://dieghernan.github.io/">Diego Hernangómez</a>, <a href="https://blog.uclm.es/gemafaviles/">Gema Fernández-Avilés</a>, part of the <span class="ROS-light">rOpenSpain</span> project.
			<hr class="hidden-md hidden-lg hidden-sm">
</div>
		<div class="col-md-3 col-sm-6 col-md-offset-4">
			<h4 data-toc-skip>About <img src="../../ROS-logo.png" alt="ROpenSpain Logo" height="24"><span class="ROS-light"> rOpenSpain</span>
</h4>
			<a href="https://ropenspain.es/"><span class="ROS-light">rOpenSpain</span></a> is a community of R enthusiasts whose ultimate goal is to create high-quality R packages for data mining public Spanish open sources.
			<hr class="hidden-md hidden-lg hidden-sm">
</div>
	</div>
</footer><div id="copyright">
	<div class="container">
		<div class="col-md-12">
			<p class="pull-left">
			Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.
			</p>
			<p class="pull-right">
			Template by <a href="https://bootstrapious.com/snippets">Bootstrapious </a>.
			Ported to pkgdown by <a href="https://github.com/dieghernan/">dieghernan</a>.
			</p>
		</div>
	</div>
</div>

<!-- ropenspain -->
<script src="../../ropenspain.js"></script>
</div>
   
  


  </body>
</html>
